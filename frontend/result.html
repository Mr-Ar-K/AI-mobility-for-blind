<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Results | Object Detection</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 flex justify-center items-center min-h-screen relative">
<!-- User Profile Logo - Top Left -->
<div class="absolute top-4 left-4 cursor-pointer bg-blue-600 w-10 h-10 rounded-full flex items-center justify-center shadow hover:shadow-md">
  <!-- User Icon SVG -->
  <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24">
    <path d="M12 12c2.7 0 4.8-2.1 4.8-4.8S14.7 2.4 12 2.4 7.2 4.5 7.2 7.2 9.3 12 12 12zm0 2.4c-3.2 0-9.6 1.6-9.6 4.8v2.4h19.2v-2.4c0-3.2-6.4-4.8-9.6-4.8z"/>
  </svg>
</div>

<!-- Settings Logo - Top Right -->
<div class="absolute top-4 right-4 cursor-pointer bg-gray-200 w-10 h-10 rounded-full flex items-center justify-center shadow hover:shadow-md">
  <!-- Gear Icon SVG -->
  <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 text-gray-700" fill="currentColor" viewBox="0 0 24 24">
    <path d="M19.43 12.98c.04-.32.07-.66.07-1s-.03-.68-.07-1l2.11-1.65a.504.504 0 00.12-.65l-2-3.46a.5.5 0 00-.61-.22l-2.49 1a7.007 7.007 0 00-1.7-.99l-.38-2.65A.5.5 0 0014 2h-4c-.26 0-.48.19-.5.45l-.38 2.65c-.63.24-1.22.57-1.7.99l-2.49-1a.5.5 0 00-.61.22l-2 3.46c-.14.24-.09.54.12.65l2.11 1.65c-.04.32-.07.66-.07 1s.03.68.07 1l-2.11 1.65a.504.504 0 00-.12.65l2 3.46c.14.24.42.33.61.22l2.49-1c.48.42 1.07.75 1.7.99l.38 2.65c.02.26.24.45.5.45h4c.26 0 .48-.19.5-.45l.38-2.65c.63-.24 1.22-.57 1.7-.99l2.49 1c.19.11.47.02.61-.22l2-3.46a.5.5 0 00-.12-.65l-2.11-1.65zM12 15.5c-1.93 0-3.5-1.57-3.5-3.5s1.57-3.5 3.5-3.5 3.5 1.57 3.5 3.5-1.57 3.5-3.5 3.5z"/>
  </svg>
</div>

  <h1 class="text-4xl font-bold text-blue-600 absolute top-16 left-1/2 transform -translate-x-1/2 text-center">
    Object Detection
  </h1>

  <div id="voicePrompt" class="absolute top-36 left-1/2 transform -translate-x-1/2 text-center text-gray-700"></div>

  <div class="bg-white p-8 rounded-2xl shadow-md w-96 text-center">
    <h2 class="text-2xl font-bold mb-6">Detected Objects</h2>

    <div id="resultContent" class="border p-4 mb-4 rounded h-48 overflow-auto text-left text-gray-800">
      <p>Car detected at center, Zebra crossing at middle, Person on right, Traffic lights green at top middle.</p>
    </div>

    <button id="downloadBtn" class="w-full bg-blue-600 text-white p-2 rounded hover:bg-blue-700 transition mb-2">
      Download Result
    </button>

    <button id="repeatBtn" class="w-full bg-green-600 text-white p-2 rounded hover:bg-green-700 transition">
      Repeat Results
    </button>

    <p class="text-gray-500 mt-2 text-sm">Use voice commands: "download" or "repeat results"</p>
  </div>

  <script>
    const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    recognition.continuous = true;
    recognition.interimResults = false;
    recognition.lang='en-US';

    function speak(text){const u=new SpeechSynthesisUtterance(text);speechSynthesis.speak(u);}

    function downloadResult(){
      const resultText=document.getElementById("resultContent").innerText;
      const blob=new Blob([resultText],{type:"text/plain"});
      const link=document.createElement("a");
      link.href=URL.createObjectURL(blob);
      link.download="detected_objects.txt";
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      speak("Results downloaded successfully.");
    }

    function handleVoiceCommand(text){
      text=text.toLowerCase().trim();
      const resultText=document.getElementById("resultContent").innerText;

      if(text.includes("download")){
        recognition.stop();
        downloadResult();
        setTimeout(()=>recognition.start(),1000);
      } else if(text.includes("repeat results")){
        recognition.stop();
        speak("Repeating detected objects: " + resultText);
        setTimeout(()=>recognition.start(),1000);
      }
    }

    recognition.onresult=(event)=>{
      handleVoiceCommand(event.results[event.resultIndex][0].transcript);
    };
    recognition.onerror=(event)=>console.error("Speech Recognition Error:",event.error);

    document.getElementById("downloadBtn").addEventListener("click",downloadResult);
    document.getElementById("repeatBtn").addEventListener("click",()=>{
      const resultText=document.getElementById("resultContent").innerText;
      speak("Repeating detected objects: "+resultText);
    });

    window.onload=()=>{
      const voicePrompt=document.getElementById("voicePrompt");
      const resultText=document.getElementById("resultContent").innerText;
    
      // Read results first
      speak("Detected objects are: "+resultText);

      // After short delay, show click instruction
      setTimeout(()=>{
        voicePrompt.innerText="Click anywhere to start voice commands";
        speak("Click anywhere to start voice commands.");
      },2000);

      document.body.addEventListener("click",()=>{
        recognition.start();
        speak("Voice recognition started. You can say repeat results or download them.");
        voicePrompt.style.display="none";
      },{once:true});
    };
  </script>
</body>
</html>
